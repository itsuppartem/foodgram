# Foodgram

## Описание
Foodgram - это полнофункциональная социальная сеть для публикации кулинарных рецептов, предлагающая как удобный веб-интерфейс, так и мощный REST API. Проект позволяет пользователям:
- **Публиковать и управлять рецептами** с подробным описанием, списком ингредиентов, шагами приготовления, временем готовки и уровнем сложности, а также загружать изображения.
- **Подписываться** на других пользователей и просматривать рецепты их авторов в отдельной ленте.
- **Добавлять рецепты в избранное**, чтобы легко находить их позже.
- **Формировать списки покупок** на основе выбранных рецептов с возможностью экспорта в PDF.
- **Оставлять комментарии** к рецептам и получать уведомления о новых комментариях через Telegram.
- **Взаимодействовать с AI-помощником** для генерации новых рецептов по текстовому описанию, создания изображений для рецептов и получения ответов на кулинарные вопросы.
- Просматривать и управлять всеми функциями через интуитивно понятный веб-интерфейс.
- Использовать полнофункциональный **REST API** для интеграции со сторонними приложениями.

## Функционал

### Пользователи
- **Регистрация и аутентификация:** Пользователи могут регистрироваться (по email) и входить в систему.
- **Профиль пользователя:** Просмотр личной информации, статистики (количество подписчиков, избранных рецептов, просмотров рецептов), и всех опубликованных рецептов.
- **Редактирование профиля:** Возможность изменения данных пользователя.
- **Подписки:** Подписка на других авторов и отписка от них. Просмотр ленты рецептов только от авторов, на которых подписан пользователь.
- **Интеграция с Telegram:** Возможность привязать Telegram ID для получения уведомлений о новых комментариях к своим рецептам.

### Рецепты
- **Создание и редактирование:** Полный CRUD для рецептов с указанием названия, описания, времени приготовления, сложности, тегов и ингредиентов с их количеством.
- **Просмотр:** Детальная страница рецепта с полной информацией, списком ингредиентов и пошаговой инструкцией.
- **Лента рецептов:** Главная страница с последними рецептами и возможность переключения на рецепты из подписок.
- **Избранное:** Добавление рецептов в список избранного для быстрого доступа.
- **Список покупок:** Автоматическое формирование списка всех необходимых ингредиентов из выбранных рецептов с суммированием количества. Возможность скачать список в формате PDF.
- **Просмотры и Избранное:** Автоматический подсчет просмотров рецептов и количества добавлений в избранное.
- **Комментарии:** Добавление и удаление комментариев к рецептам.

### Интеграция с Искусственным Интеллектом (AI)
- **Генерация рецептов:** Возможность сгенерировать полный рецепт (название, описание, ингредиенты, шаги, время, сложность, промпт для изображения) на основе текстового запроса.
- **Генерация изображений:** Создание уникальных изображений для рецептов по заданному промпту.
- **AI-помощник (чат-бот):** Интерактивный чат-бот для получения ответов на кулинарные вопросы и другие запросы.

### API
- **RESTful API:** Полностью документированный API для управления тегами, ингредиентами, рецептами, избранным, списком покупок, комментариями и подписками.
- **Аутентификация:** Поддержка Token-аутентификации для доступа к защищенным эндпоинтам.
- **Фильтрация и пагинация:** Возможность фильтровать рецепты по тегам, авторам, состоянию (в избранном/в списке покупок) и постранично получать данные.

## Технологии
Проект разработан с использованием следующих технологий:
- **Backend:**
    - Python 3.9+
    - Django 3.2 (Веб-фреймворк)
    - Django REST Framework (DRF) (Для построения API)
    - Djoser (Для управления аутентификацией пользователей)
    - `django-filters` (Для расширенной фильтрации в API)
    - `drf-yasg` (Для автоматической генерации Swagger/Redoc документации API)
    - `reportlab` (Для генерации PDF списка покупок)
    - `httpx` (Для асинхронных HTTP-запросов к AI-сервису)
    - `Pillow` (Для обработки изображений)
    - `django-bootstrap4` (Для удобной работы с Bootstrap в Django шаблонах)
    - `python-dotenv` (Для управления переменными окружения)
    - `redis` (Предполагается для кэширования, хотя в `settings.py` указан LocMemCache, который может быть заменен на Redis для продакшна)
- **База данных:** PostgreSQL
- **Сервер:**
    - Gunicorn (WSGI HTTP-сервер)
    - Nginx (Обратный прокси-сервер)
    - Whitenoise (Для раздачи статических файлов в продакшне)
- **Frontend (частично):**
    - HTML5
    - CSS3
    - Bootstrap 5 (CSS-фреймворк)
    - JavaScript (jQuery, Marked.js для рендеринга Markdown)
    - Font Awesome (Иконки)
    - Animate.css (Анимации)
- **Инфраструктура:** Docker, Docker Compose
- **Тестирование:** `pytest`

## Структура проекта
```
.
├── backend/                  # Корневая директория Django проекта
│   ├── foodgram/             # Основное приложение для рецептов
│   │   ├── admin.py          # Конфигурация админ-панели для моделей Foodgram
│   │   ├── apps.py           # Конфигурация приложения
│   │   ├── forms.py          # Формы для веб-интерфейса (создание/редактирование рецептов)
│   │   ├── filters.py        # Фильтры для API
│   │   ├── models.py         # Модели данных (Recipe, Ingredient, Tag, Favorite, ShoppingCart, Comment, ChefAdvice, RecipeHistory, DrinkPairing)
│   │   ├── pagination.py     # Пользовательские классы пагинации
│   │   ├── permissions.py    # Пользовательские классы разрешений для API
│   │   ├── serializers.py    # Сериализаторы для API
│   │   ├── signals.py        # Обработчики сигналов (валидация моделей)
│   │   ├── urls.py           # URL-маршруты API и веб-интерфейса для Foodgram
│   │   ├── views.py          # Функции и классы представлений API и веб-интерфейса Foodgram
│   │   └── services/         # Сервисы (например, ai_service.py)
│   │       └── ai_service.py # Интеграция с внешним AI сервисом
│   │   └── management/       # Пользовательские команды Django
│   │       └── commands/
│   │           ├── load_ingredients.py # Команда для загрузки ингредиентов из CSV
│   │           └── load_tags.py        # Команда для загрузки тегов из CSV
│   ├── backend/              # Основные настройки проекта Django
│   │   ├── asgi.py           # Конфигурация ASGI
│   │   ├── settings.py       # Основные настройки Django (переменные окружения, установленные приложения, БД, DRF, кэш, AI/Telegram API ключи)
│   │   ├── urls.py           # Главные URL-маршруты проекта (включает Foodgram и Users)
│   │   └── wsgi.py           # Конфигурация WSGI
│   ├── users/                # Приложение для управления пользователями
│   │   ├── admin.py          # Конфигурация админ-панели для моделей User
│   │   ├── apps.py           # Конфигурация приложения
│   │   ├── forms.py          # Формы для веб-интерфейса (регистрация, редактирование профиля)
│   │   ├── models.py         # Модели данных (CustomUser, Follow)
│   │   ├── serializers.py    # Сериализаторы для API
│   │   ├── urls.py           # URL-маршруты API и веб-интерфейса для Users
│   │   └── views.py          # Функции и классы представлений API и веб-интерфейса Users
│   ├── templates/            # Директория с HTML-шаблонами
│   │   ├── base.html         # Базовый шаблон (общие стили, навигация, AI-чат модал)
│   │   ├── favorites.html    # Шаблон страницы избранных рецептов
│   │   ├── index.html        # Шаблон главной страницы
│   │   ├── login.html        # Шаблон страницы входа
│   │   ├── my_subscriptions.html # Шаблон страницы моих подписок
│   │   ├── profile.html      # Шаблон страницы профиля пользователя
│   │   ├── profile_edit.html # Шаблон страницы редактирования профиля
│   │   ├── recipe_confirm_delete.html # Шаблон подтверждения удаления рецепта
│   │   ├── recipe_detail.html # Шаблон детального просмотра рецепта
│   │   ├── recipe_form.html  # Шаблон формы создания/редактирования рецепта
│   │   ├── recipe_list.html  # Шаблон страницы списка рецептов
│   │   ├── recipe_list_partial.html # Частичный шаблон для AJAX-обновления списка рецептов
│   │   └── shopping_list.html # Шаблон страницы списка покупок
│   ├── data/                 # Директория для CSV-файлов с начальными данными
│   ├── tests/                # Директория с автотестами
│   ├── requirements.txt      # Список зависимостей Python
│   ├── Dockerfile            # Конфигурация Docker-образа
│   ├── docker-compose.yml    # Конфигурация для запуска проекта в Docker-контейнерах
│   └── manage.py             # Утилита командной строки Django
```

## Документация API
API документация доступна через Swagger UI и ReDoc после запуска проекта:
- **Swagger UI:** `/swagger/`
- **ReDoc:** `/redoc/`
- **OpenAPI Schema (JSON):** `/swagger.json/`

## Установка и запуск проекта (с использованием Docker Compose)

### Предварительные требования
Убедитесь, что у вас установлен Docker и Docker Compose.

### 1. Клонирование репозитория
```bash
git clone <ваш_репозиторий_foodgram>
cd foodgram/backend
```

### 2. Настройка переменных окружения
Создайте файл `.env` в корневой директории `backend/` (там же, где `docker-compose.yml`) и заполните его следующими переменными. Замените значения `<...>` на свои:

```dotenv
SECRET_KEY=<ваш_секретный_ключ_django>
DEBUG=True
ALLOWED_HOSTS=localhost,127.0.0.1,<ваш_ip_или_домен>

# Настройки базы данных PostgreSQL
DB_ENGINE=django.db.backends.postgresql
DB_NAME=<имя_вашей_бд>
POSTGRES_USER=<пользователь_бд>
POSTGRES_PASSWORD=<пароль_бд>
DB_HOST=db # Имя сервиса базы данных в docker-compose.yml
DB_PORT=5432

# Настройки AI сервиса (URL и API ключ вашего внешнего AI сервиса)
AI_API_URL=<url_ai_сервиса> # Например: http://ai_service:8001
AI_API_KEY=<ваш_ai_api_ключ>

# Настройки Telegram бота (токен вашего Telegram бота)
TELEGRAM_BOT_TOKEN=<токен_telegram_бота>

# Настройки кэша (опционально, по умолчанию используется LocMemCache)
CACHE_TTL=900 # Время жизни кэша в секундах (15 минут)
```

### 3. Запуск контейнеров
Из директории `backend/` выполните:
```bash
docker-compose up -d --build
```
Это соберет образы и запустит контейнеры в фоновом режиме.

### 4. Выполнение миграций базы данных
```bash
docker-compose exec web python manage.py migrate
```

### 5. Сбор статических файлов
```bash
docker-compose exec web python manage.py collectstatic --noinput
```

### 6. Загрузка начальных данных (Теги и Ингредиенты)
```bash
docker-compose exec web python manage.py load_tags
docker-compose exec web python manage.py load_ingredients
```

### 7. Создание суперпользователя (для доступа к админ-панели)
```bash
docker-compose exec web python manage.py createsuperuser
```
Следуйте инструкциям в терминале для создания учетной записи.

## Использование
После успешного запуска:
- **Веб-интерфейс:** Откройте в браузере `http://localhost/` (или `http://<ваш_ip_или_домен>/`).
- **Админ-панель:** Откройте `http://localhost/admin/` и войдите с учетными данными суперпользователя.
- **Документация API:**
    - Swagger UI: `http://localhost/swagger/`
    - ReDoc: `http://localhost/redoc/`

## Тестирование
Для запуска тестов в контейнере:
```bash
docker-compose exec web pytest
```

## Разработка
Для более удобной разработки, вы можете запустить контейнер `web` без Gunicorn и использовать Django Development Server:
1. Остановите существующие контейнеры: `docker-compose down`
2. Закомментируйте или измените команду в `docker-compose.yml` для сервиса `web` на `command: python manage.py runserver 0.0.0.0:8000`.
3. Запустите контейнеры: `docker-compose up -d --build`
4. Теперь вы можете получить доступ к серверу по адресу `http://localhost:8000/`.

